<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecureFlow - Scan History</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 min-h-screen">

    <!-- Navbar -->
    <nav class="bg-white shadow-lg mb-8">
        <div class="max-w-7xl mx-auto px-6 flex justify-between items-center h-16">
            <div class="flex items-center gap-3">
                <i class="fas fa-shield-alt text-indigo-600 text-2xl"></i>
                <h1 class="text-2xl font-bold text-gray-800">
                    Secure<span class="text-indigo-600">Flow</span>
                </h1>
            </div>
            <div class="flex items-center gap-3">
                <a href="/" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 font-semibold">
                    <i class="fas fa-home"></i> Dashboard
                </a>
                <a href="/history" class="px-4 py-2 bg-indigo-600 text-white rounded-lg font-semibold">
                    <i class="fas fa-history"></i> History
                </a>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-6 pb-12">

        <!-- Header -->
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
            <h2 class="text-3xl font-bold text-gray-800 flex items-center gap-3">
                <i class="fas fa-history text-indigo-600"></i>
                Scan History
            </h2>
            <p class="text-gray-500 mt-2">Track your security progress over time</p>
        </div>

        {% if scans %}

        <!-- Trend Chart -->
        <div class="bg-white rounded-2xl shadow-lg p-8 mb-6">
            <h3 class="text-2xl font-bold text-gray-800 mb-6">
                <i class="fas fa-chart-line text-indigo-600 mr-2"></i>
                Vulnerability Trend
            </h3>
            <canvas id="trendChart" height="80"></canvas>
        </div>

        <!-- Scan List -->
        <div class="bg-white rounded-2xl shadow-lg p-6">
            <h3 class="text-2xl font-bold text-gray-800 mb-6">Recent Scans</h3>
            
            <div class="space-y-4">
                {% for scan in scans %}
                <div class="border-2 border-gray-200 rounded-xl p-6 hover:border-indigo-300 transition-all">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-lg font-bold text-gray-800">
                                Scan #{{ scan.id }}
                            </div>
                            <div class="text-sm text-gray-500">
                                <i class="fas fa-clock mr-1"></i>
                                {{ scan.timestamp }}
                            </div>
                            <div class="text-sm text-gray-600 mt-1">
                                <i class="fas fa-folder mr-1"></i>
                                {{ scan.target_path }}
                            </div>
                        </div>
                        
                        <div class="text-right">
                            <div class="text-3xl font-bold text-indigo-600">
                                {{ scan.total_findings }}
                            </div>
                            <div class="text-sm text-gray-500">Total Findings</div>
                        </div>
                    </div>
                    
                    <div class="flex gap-4 flex-wrap">
                        <span class="px-3 py-1 bg-red-100 text-red-700 rounded-lg text-sm font-semibold">
                            ðŸ”´ {{ scan.critical }} Critical
                        </span>
                        <span class="px-3 py-1 bg-orange-100 text-orange-700 rounded-lg text-sm font-semibold">
                            ðŸŸ  {{ scan.high }} High
                        </span>
                        <span class="px-3 py-1 bg-yellow-100 text-yellow-700 rounded-lg text-sm font-semibold">
                            ðŸŸ¡ {{ scan.medium }} Medium
                        </span>
                        <span class="px-3 py-1 bg-green-100 text-green-700 rounded-lg text-sm font-semibold">
                            ðŸŸ¢ {{ scan.low }} Low
                        </span>
                    </div>
                    
                    <div class="mt-4 pt-4 border-t flex justify-between items-center">
                        <div class="text-sm text-gray-600">
                            Duration: {{ "%.1f"|format(scan.duration) }}s
                        </div>
                        
                        {% if loop.index > 1 %}
                        <a href="/compare/{{ scans[loop.index - 1].id }}/{{ scan.id }}"
                           class="px-4 py-2 bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 font-semibold text-sm">
                            <i class="fas fa-exchange-alt"></i> Compare with Previous
                        </a>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        {% else %}

        <div class="bg-white rounded-2xl shadow-lg p-16 text-center">
            <i class="fas fa-history text-8xl text-gray-300 mb-6"></i>
            <h3 class="text-2xl font-bold text-gray-700">No Scan History Yet</h3>
            <p class="text-gray-500 mt-2">Run some scans to start tracking your progress!</p>
            <a href="/" class="mt-6 inline-block px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-semibold">
                Go to Dashboard
            </a>
        </div>

        {% endif %}

    </div>

    <script>
    {% if scans %}
    // Trend chart
    new Chart(document.getElementById('trendChart'), {
        type: 'line',
        data: {
            labels: [{% for scan in scans|reverse %}'Scan #{{ scan.id }}',{% endfor %}],
            datasets: [
                {
                    label: 'Total Vulnerabilities',
                    data: [{% for scan in scans|reverse %}{{ scan.total_findings }},{% endfor %}],
                    borderColor: '#6366f1',
                    backgroundColor: 'rgba(99, 102, 241, 0.1)',
                    tension: 0.4,
                    fill: true
                },
                {
                    label: 'Critical',
                    data: [{% for scan in scans|reverse %}{{ scan.critical }},{% endfor %}],
                    borderColor: '#ef4444',
                    backgroundColor: 'rgba(239, 68, 68, 0.1)',
                    tension: 0.4,
                    fill: true
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    position: 'top',
                    labels: { font: { size: 14, weight: 'bold' } }
                }
            },
            scales: {
                y: { 
                    beginAtZero: true,
                    ticks: { font: { size: 12 } }
                },
                x: {
                    ticks: { font: { size: 12 } }
                }
            }
        }
    });
    {% endif %}
    </script>

</body>
</html>
